<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Docker and Ansible" href="Docker.html" /><link rel="prev" title="Wizardlab-docs" href="wizardlab-docs.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>Ansible Roles and “The Wizard” - Bill the Wizard&#39;s Homepage</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Bill the Wizard's Homepage</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Bill the Wizard's Homepage</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Art.html">Art</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Biography.html">Biography</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Devops</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Devops</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Wizardlab.html">Wizard Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="Playbooks.html">Wizardlab: How it Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="Wizardlab-bind9.html">Wizardlab DNS Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Wizardlab-bind9.html#wizardlab-bind9">Wizardlab-bind9</a></li>
<li class="toctree-l2"><a class="reference internal" href="wizardlab-docs.html">Wizardlab-docs</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Ansible Roles and “The Wizard”</a></li>
<li class="toctree-l2"><a class="reference internal" href="Docker.html">Docker and Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hypervisors.html">Hypervisors</a></li>
<li class="toctree-l2"><a class="reference internal" href="install_docker.html">Install Docker on Debian</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../linux/index.html">Linux</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Linux</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../linux/Chroot.html">Linux Recovery with Live USB and Chroot</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/devops/ansible-thewizard.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="ansible-roles-and-the-wizard">
<h1>Ansible Roles and “The Wizard”<a class="headerlink" href="#ansible-roles-and-the-wizard" title="Link to this heading">¶</a></h1>
<p>Ansible’s role features are really helpful for creating reusable chunks of
configuration.</p>
<p>I wanted to create a fun context for exploring roles, so I built this
little project that debugs Black Sabbath’s “The Wizard”.</p>
<section id="try-it-out">
<h2>Try it out<a class="headerlink" href="#try-it-out" title="Link to this heading">¶</a></h2>
<section id="clone-the-repository">
<h3>Clone the repository<a class="headerlink" href="#clone-the-repository" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/ashemath/ansible-thewizard</span></code></p>
</section>
<section id="install-ansible">
<h3>Install ansible<a class="headerlink" href="#install-ansible" title="Link to this heading">¶</a></h3>
<p>You can install ansible in a Python venv with the provided script:</p>
<p><code class="docutils literal notranslate"><span class="pre">./setup_ansible</span></code></p>
<p>Activate your the installed venv by running <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">bin/activate</span></code>
This will add the venv’s packages to your PATH variable until you run
<code class="docutils literal notranslate"><span class="pre">deactivate</span></code>.</p>
<p>Alternatively, you could use system-level ansible. This project
uses only core ansible functionality.</p>
</section>
<section id="run-the-playbook">
<h3>Run the playbook<a class="headerlink" href="#run-the-playbook" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ansible-playbook</span> <span class="pre">apply_roles.yml</span></code></p>
</section>
</section>
<section id="the-design">
<h2>The design<a class="headerlink" href="#the-design" title="Link to this heading">¶</a></h2>
<section id="the-wizard">
<h3>“The Wizard”<a class="headerlink" href="#the-wizard" title="Link to this heading">¶</a></h3>
<p>The song has three verses and a chorus that repeats after each verse.
The chorus changes on the 2nd iteration, and stays that way for the
3rd.</p>
<p>We’ll be using task, variable, and meta main.yml files. Here’s the <code class="docutils literal notranslate"><span class="pre">tree</span></code>
of the folder structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>roles/
├── role_a
│   ├── tasks
│   │   ├── chorus.yml
│   │   └── main.yml
│   └── vars
│       └── main.yml
├── role_b
│   ├── meta
│   │   └── main.yml
│   ├── tasks
│   │   └── main.yml
│   └── vars
│       └── main.yml
└── role_c
    ├── meta
    │   └── main.yml
    ├── tasks
    │   └── main.yml
    └── vars
        └── main.yml
</pre></div>
</div>
</section>
<section id="the-playbook-file">
<h3>The playbook file<a class="headerlink" href="#the-playbook-file" title="Link to this heading">¶</a></h3>
<p>We’re going to run all three roles by calling for only the last role in
the dependency chain.</p>
<p><code class="docutils literal notranslate"><span class="pre">apply_roles.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apply roles</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">  </span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">role_c</span>
</pre></div>
</div>
</section>
<section id="the-dependency-chain">
<h3>The dependency chain<a class="headerlink" href="#the-dependency-chain" title="Link to this heading">¶</a></h3>
<p>When we call role_c, it is dependent on role_b, and role_b is dependent on
role_a</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cat</span> <span class="pre">roles/role_b/meta/main.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">role_a</span>
</pre></div>
</div>
<p>..
<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cat</span> <span class="pre">roles/role_c/meta/main.yml</span></code>
..</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">role_b</span>
</pre></div>
</div>
</section>
<section id="the-task-files">
<h3>The task files<a class="headerlink" href="#the-task-files" title="Link to this heading">¶</a></h3>
<p>The task file for role_a does most of the heavy lifting.
It executes debug message tasks that “sing” the lyrics.</p>
<p>I include a idempotency exercise that pulls on the <code class="docutils literal notranslate"><span class="pre">role_name</span></code> special
variable to craft a file in a generated <code class="docutils literal notranslate"><span class="pre">proof/</span></code> folder.</p>
<p><code class="docutils literal notranslate"><span class="pre">roles/role_a/tasks/main.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">What role are we executing?</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;We</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">role_name</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print verse specified for this role.</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.msg</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">verse</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">include the chorus</span>
<span class="w">  </span><span class="nt">import_tasks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/roles/role_a/tasks/chorus.yml&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure the proof folder exists</span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/proof/&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">  </span><span class="nt">run_once</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">idempotency/proof task</span>
<span class="w">  </span><span class="nt">lineinfile</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/proof/{{</span><span class="nv"> </span><span class="s">role_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">line</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">role_name</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">here&quot;</span>
<span class="w">    </span><span class="nt">create</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">import role_a&#39;s tasks</span>
<span class="w">  </span><span class="nt">import_tasks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/roles/role_a/tasks/main.yml&quot;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">import role_a&#39;s tasks</span>
<span class="w">  </span><span class="nt">import_tasks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/roles/role_a/tasks/main.yml&quot;</span>
</pre></div>
</div>
<p>The task file for role_b just imports the tasks from role_a, and we
do the same thing with role_c:</p>
<p><code class="docutils literal notranslate"><span class="pre">roles/role_b/tasks/main.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">import role_a&#39;s tasks</span>
<span class="w">  </span><span class="nt">import_tasks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/roles/role_a/tasks/main.yml&quot;</span>
</pre></div>
</div>
<p>Finally, we have a chorus.yml file that defines how we produce the chorus
and post-chorus. This file lives under role_a:</p>
<p><code class="docutils literal notranslate"><span class="pre">roles/role_a/tasks/chorus.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chorus</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">chorus</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">post_chorus</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">post_chorus</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</section>
<section id="the-vars-files">
<h3>The vars files<a class="headerlink" href="#the-vars-files" title="Link to this heading">¶</a></h3>
<p>Each role contains unique lyrics from “The Wizard.” The roles divide the
song into a dictionary <code class="docutils literal notranslate"><span class="pre">verse</span></code>, list <code class="docutils literal notranslate"><span class="pre">chorus</span></code>, and string <code class="docutils literal notranslate"><span class="pre">post-chorus</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">roles/role_a/vars/main.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">verse</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Misty</span><span class="nv"> </span><span class="s">morning,</span><span class="nv"> </span><span class="s">clouds</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">sky&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Without</span><span class="nv"> </span><span class="s">warning,</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">wizard</span><span class="nv"> </span><span class="s">walks</span><span class="nv"> </span><span class="s">by&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Casting</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">shadow,</span><span class="nv"> </span><span class="s">weaving</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">spell&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Long</span><span class="nv"> </span><span class="s">grey</span><span class="nv"> </span><span class="s">cloak,</span><span class="nv"> </span><span class="s">tinkling</span><span class="nv"> </span><span class="s">bell&quot;</span>
<span class="nt">chorus</span><span class="p">:</span><span class="w"> </span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Never</span><span class="nv"> </span><span class="s">Talking&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Justkeeps</span><span class="nv"> </span><span class="s">walking&quot;</span>
<span class="nt">post_chorus</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Cursing</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">magic&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">roles/role_b/vars/main.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">verse</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Evil</span><span class="nv"> </span><span class="s">power</span><span class="nv"> </span><span class="s">disappears&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Demons</span><span class="nv"> </span><span class="s">worry</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">wizard</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">near&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;He</span><span class="nv"> </span><span class="s">turns</span><span class="nv"> </span><span class="s">tears</span><span class="nv"> </span><span class="s">into</span><span class="nv"> </span><span class="s">joy&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Everyone&#39;s</span><span class="nv"> </span><span class="s">happy</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">wizard</span><span class="nv"> </span><span class="s">walks</span><span class="nv"> </span><span class="s">by&quot;</span>
<span class="nt">post_chorus</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Spreading</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">magic&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">roles/role_c/vars/main.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">verse</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Sun</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">shining,</span><span class="nv"> </span><span class="s">clouds</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">gone</span><span class="nv"> </span><span class="s">by&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;All</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">people</span><span class="nv"> </span><span class="s">give</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">happy</span><span class="nv"> </span><span class="s">sigh&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;He</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">passed</span><span class="nv"> </span><span class="s">by,</span><span class="nv"> </span><span class="s">giving</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">sign&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;msg&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Left</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">people</span><span class="nv"> </span><span class="s">feeling</span><span class="nv"> </span><span class="s">so</span><span class="nv"> </span><span class="s">fine&quot;</span>
</pre></div>
</div>
</section>
<section id="the-results">
<h3>The results<a class="headerlink" href="#the-results" title="Link to this heading">¶</a></h3>
<p>When we run the playbooks the first time:</p>
<p><code class="docutils literal notranslate"><span class="pre">results.txt</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PLAY [apply roles] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [role_a : What role are we executing?] ************************************
ok: [localhost] =&gt; {
    &quot;msg&quot;: &quot;We are running this task for role_a&quot;
}

TASK [role_a : Print verse specified for this role.] ***************************
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;Misty morning, clouds in the sky&#39;}) =&gt; {
    &quot;msg&quot;: &quot;Misty morning, clouds in the sky&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;Without warning, the wizard walks by&#39;}) =&gt; {
    &quot;msg&quot;: &quot;Without warning, the wizard walks by&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;Casting his shadow, weaving his spell&#39;}) =&gt; {
    &quot;msg&quot;: &quot;Casting his shadow, weaving his spell&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;Long grey cloak, tinkling bell&#39;}) =&gt; {
    &quot;msg&quot;: &quot;Long grey cloak, tinkling bell&quot;
}

TASK [role_a : chorus] *********************************************************
ok: [localhost] =&gt; (item=Never Talking) =&gt; {
    &quot;msg&quot;: &quot;Never Talking&quot;
}
ok: [localhost] =&gt; (item=Just keeps walking) =&gt; {
    &quot;msg&quot;: &quot;Just keeps walking&quot;
}

TASK [role_a : post_chorus] ****************************************************
ok: [localhost] =&gt; {
    &quot;msg&quot;: &quot;Cursing his magic&quot;
}

TASK [role_a : Ensure the proof folder exists] *********************************
changed: [localhost]

TASK [role_a : idempotency/proof task] *****************************************
changed: [localhost]

TASK [role_b : What role are we executing?] ************************************
ok: [localhost] =&gt; {
    &quot;msg&quot;: &quot;We are running this task for role_b&quot;
}

TASK [role_b : Print verse specified for this role.] ***************************
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;Evil power disappears&#39;}) =&gt; {
    &quot;msg&quot;: &quot;Evil power disappears&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;Demons worry when the wizard is near&#39;}) =&gt; {
    &quot;msg&quot;: &quot;Demons worry when the wizard is near&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;He turns tears into joy&#39;}) =&gt; {
    &quot;msg&quot;: &quot;He turns tears into joy&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &quot;Everyone&#39;s happy when the wizard walks by&quot;}) =&gt; {
    &quot;msg&quot;: &quot;Everyone&#39;s happy when the wizard walks by&quot;
}

TASK [role_b : chorus] *********************************************************
ok: [localhost] =&gt; (item=Never Talking) =&gt; {
    &quot;msg&quot;: &quot;Never Talking&quot;
}
ok: [localhost] =&gt; (item=Just keeps walking) =&gt; {
    &quot;msg&quot;: &quot;Just keeps walking&quot;
}

TASK [role_b : post_chorus] ****************************************************
ok: [localhost] =&gt; {
    &quot;msg&quot;: &quot;Spreading his magic&quot;
}

TASK [role_b : Ensure the proof folder exists] *********************************
ok: [localhost]

TASK [role_b : idempotency/proof task] *****************************************
changed: [localhost]

TASK [role_c : What role are we executing?] ************************************
ok: [localhost] =&gt; {
    &quot;msg&quot;: &quot;We are running this task for role_c&quot;
}

TASK [role_c : Print verse specified for this role.] ***************************
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;Sun is shining, clouds have gone by&#39;}) =&gt; {
    &quot;msg&quot;: &quot;Sun is shining, clouds have gone by&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;All the people give a happy sigh&#39;}) =&gt; {
    &quot;msg&quot;: &quot;All the people give a happy sigh&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;He has passed by, giving his sign&#39;}) =&gt; {
    &quot;msg&quot;: &quot;He has passed by, giving his sign&quot;
}
ok: [localhost] =&gt; (item={&#39;msg&#39;: &#39;Left all the people feeling so fine&#39;}) =&gt; {
    &quot;msg&quot;: &quot;Left all the people feeling so fine&quot;
}

TASK [role_c : chorus] *********************************************************
ok: [localhost] =&gt; (item=Never Talking) =&gt; {
    &quot;msg&quot;: &quot;Never Talking&quot;
}
ok: [localhost] =&gt; (item=Just keeps walking) =&gt; {
    &quot;msg&quot;: &quot;Just keeps walking&quot;
}

TASK [role_c : post_chorus] ****************************************************
ok: [localhost] =&gt; {
    &quot;msg&quot;: &quot;Spreading his magic&quot;
}

TASK [role_c : Ensure the proof folder exists] *********************************
ok: [localhost]

TASK [role_c : idempotency/proof task] *****************************************
changed: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=19   changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  
</pre></div>
</div>
<p>Let’s grep the results for <code class="docutils literal notranslate"><span class="pre">&quot;msg&quot;</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">results.txt</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">\&quot;msg\&quot;</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;We</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">role_a&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Misty</span><span class="nv"> </span><span class="s">morning,</span><span class="nv"> </span><span class="s">clouds</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">sky&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Without</span><span class="nv"> </span><span class="s">warning,</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">wizard</span><span class="nv"> </span><span class="s">walks</span><span class="nv"> </span><span class="s">by&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Casting</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">shadow,</span><span class="nv"> </span><span class="s">weaving</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">spell&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Long</span><span class="nv"> </span><span class="s">grey</span><span class="nv"> </span><span class="s">cloak,</span><span class="nv"> </span><span class="s">tinkling</span><span class="nv"> </span><span class="s">bell&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Never</span><span class="nv"> </span><span class="s">Talking&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Just</span><span class="nv"> </span><span class="s">keeps</span><span class="nv"> </span><span class="s">walking&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Cursing</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">magic&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;We</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">role_b&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Evil</span><span class="nv"> </span><span class="s">power</span><span class="nv"> </span><span class="s">disappears&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Demons</span><span class="nv"> </span><span class="s">worry</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">wizard</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">near&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;He</span><span class="nv"> </span><span class="s">turns</span><span class="nv"> </span><span class="s">tears</span><span class="nv"> </span><span class="s">into</span><span class="nv"> </span><span class="s">joy&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Everyone&#39;s</span><span class="nv"> </span><span class="s">happy</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">wizard</span><span class="nv"> </span><span class="s">walks</span><span class="nv"> </span><span class="s">by&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Never</span><span class="nv"> </span><span class="s">Talking&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Just</span><span class="nv"> </span><span class="s">keeps</span><span class="nv"> </span><span class="s">walking&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Spreading</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">magic&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;We</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">role_c&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Sun</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">shining,</span><span class="nv"> </span><span class="s">clouds</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">gone</span><span class="nv"> </span><span class="s">by&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;All</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">people</span><span class="nv"> </span><span class="s">give</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">happy</span><span class="nv"> </span><span class="s">sigh&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;He</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">passed</span><span class="nv"> </span><span class="s">by,</span><span class="nv"> </span><span class="s">giving</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">sign&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Left</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">people</span><span class="nv"> </span><span class="s">feeling</span><span class="nv"> </span><span class="s">so</span><span class="nv"> </span><span class="s">fine&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Never</span><span class="nv"> </span><span class="s">Talking&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Just</span><span class="nv"> </span><span class="s">keeps</span><span class="nv"> </span><span class="s">walking&quot;</span>
<span class="w">    </span><span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;Spreading</span><span class="nv"> </span><span class="s">his</span><span class="nv"> </span><span class="s">magic&quot;</span>
</pre></div>
</div>
<p>this gives us just the debug messages.</p>
</section>
</section>
<section id="the-advantages-of-roles">
<h2>The Advantages of Roles<a class="headerlink" href="#the-advantages-of-roles" title="Link to this heading">¶</a></h2>
<p>Roles give us a mechanism for creating complex interactions between objects
(tasks, variables, handlers, etc.) and artifacts (generated files, compiled
software, processed data sets, etc.)</p>
<p>We divide our work into reusable chunks, so we can adapt and extend configuration: as needed, or on-demand. By reusing configuration code when
possible, we ensure that we can adapt our code efficiently because we can make
sweeping changes that will stay consistent across groups of systems.</p>
<section id="configuration-management">
<h3>Configuration management<a class="headerlink" href="#configuration-management" title="Link to this heading">¶</a></h3>
<p>Configuration management is when you can push out configuration changes from
a centralized platform to client systems. When configuration is modified, the
configuration will be put back into compliance the next time it’s state is
check in on.</p>
<p>Ansible’s role features allow us to build things that work at a wider scale.
Design flexible roles that install services that routinely go together.</p>
<p>We assemble configuration that works together in modular roles. Using
ansible, we can assess and correct whether the systems meet expactions for
all our roles, and we can use variables and tags to specialize things further.</p>
</section>
<section id="ideas-for-roles">
<h3>Ideas for roles:<a class="headerlink" href="#ideas-for-roles" title="Link to this heading">¶</a></h3>
<p>We could develop a ton of roles, and have the ability to adapt to a broad
range of computer use cases:</p>
<ul class="simple">
<li><p>common: generic Debian configuration</p></li>
<li><p>xfce_desk: Configured xfce4 desktop environment</p></li>
<li><p>gnome_desk: Configured gnome desktop environment</p></li>
<li><p>nvidia: Configure nvidia GPU support.</p></li>
<li><p>python: Configure generic Python execution environment</p></li>
<li><p>pythondev: Configure python development environment</p></li>
<li><p>web: configure apache and/or nginx.</p></li>
<li><p>db_mysql: Configure MySQL database</p></li>
<li><p>db_postgre: Configure PostgreSQL</p></li>
<li><p>apps_vscode: Configure vscode</p></li>
<li><p>apps_eclipse: Configure eclipse</p></li>
<li><p>apps_math: Configure mathematics applications</p></li>
<li><p>apps_twod: Configure 2D design software</p></li>
<li><p>apps_threed: Configure 3D design software</p></li>
<li><p>libs_ai: Configure AI development libraries</p></li>
</ul>
</section>
</section>
<section id="tips-for-building-roles">
<h2>Tips for Building roles:<a class="headerlink" href="#tips-for-building-roles" title="Link to this heading">¶</a></h2>
<section id="design-generic-tasks-and-flexible-variable-files">
<h3>Design generic tasks and flexible variable files<a class="headerlink" href="#design-generic-tasks-and-flexible-variable-files" title="Link to this heading">¶</a></h3>
<p>Design standarized tasks that apply configuration as specified in a roles’
variables. For example, build a loop that installs a list of services and
restarts the system daemons for you if your configuration files change.</p>
</section>
<section id="list-tasks">
<h3>–list-tasks<a class="headerlink" href="#list-tasks" title="Link to this heading">¶</a></h3>
<p>The ansible-playbook option <code class="docutils literal notranslate"><span class="pre">--list-tasks</span></code> is indespesable for ensuring your
roles are triggering the tasks that you want. It’s also good for debugging
tags!</p>
</section>
<section id="honor-the-d-r-y-principle">
<h3>Honor the D.R.Y. principle<a class="headerlink" href="#honor-the-d-r-y-principle" title="Link to this heading">¶</a></h3>
<p>Repeating a task all over makes updating your approach arduous. If each task
is generic as possible and only defined once, you can quickly iterate and
implement features.</p>
</section>
<section id="idempotency-is-your-friend">
<h3>Idempotency is your friend.<a class="headerlink" href="#idempotency-is-your-friend" title="Link to this heading">¶</a></h3>
<p>Idempotency is when your tasks are designed to only trigger when configuration
changes. Tasks that lack idempotency will run every time, even if they have
been previously applied.</p>
<p>If you have a bunch of tasks that lack idempotency in a dependency role,
you’ll multiple the number of unnecessary tasks being executed every play.
Roles are great, but layering configuration on top of configuration can lead
to really slow plays if you are waiting on a ton of unnecesary tasks to return
exit codes.</p>
<p>Efficient roles will maximize task idempotency.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Docker.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Docker and Ansible</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="wizardlab-docs.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Wizardlab-docs</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Bill Ashe
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Ansible Roles and “The Wizard”</a><ul>
<li><a class="reference internal" href="#try-it-out">Try it out</a><ul>
<li><a class="reference internal" href="#clone-the-repository">Clone the repository</a></li>
<li><a class="reference internal" href="#install-ansible">Install ansible</a></li>
<li><a class="reference internal" href="#run-the-playbook">Run the playbook</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-design">The design</a><ul>
<li><a class="reference internal" href="#the-wizard">“The Wizard”</a></li>
<li><a class="reference internal" href="#the-playbook-file">The playbook file</a></li>
<li><a class="reference internal" href="#the-dependency-chain">The dependency chain</a></li>
<li><a class="reference internal" href="#the-task-files">The task files</a></li>
<li><a class="reference internal" href="#the-vars-files">The vars files</a></li>
<li><a class="reference internal" href="#the-results">The results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-advantages-of-roles">The Advantages of Roles</a><ul>
<li><a class="reference internal" href="#configuration-management">Configuration management</a></li>
<li><a class="reference internal" href="#ideas-for-roles">Ideas for roles:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tips-for-building-roles">Tips for Building roles:</a><ul>
<li><a class="reference internal" href="#design-generic-tasks-and-flexible-variable-files">Design generic tasks and flexible variable files</a></li>
<li><a class="reference internal" href="#list-tasks">–list-tasks</a></li>
<li><a class="reference internal" href="#honor-the-d-r-y-principle">Honor the D.R.Y. principle</a></li>
<li><a class="reference internal" href="#idempotency-is-your-friend">Idempotency is your friend.</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=a4664895"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    </body>
</html>